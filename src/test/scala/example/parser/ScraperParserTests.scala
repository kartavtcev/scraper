package example.parser

import example.domain.News.NewsItem
import org.scalatest._

class ScraperParserTests extends FlatSpec with Matchers {
  "ScraperParser" should "parse Html and select .class info" in {
    // TODO: move html to resources / text file.
    val html =
      """<div class="LS-SECONDARY-ALT wsj-card clearfix media-not-first media-flow no-subhed" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1"><h3 class="wsj-headline dj-sg wsj-card-feature heading-3" itemprop="name" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.1"><a class="wsj-headline-link" href="https://www.wsj.com/articles/facebook-unveils-crypto-wallet-based-on-currency-libra-11560850141" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.1.0">Facebook Unveils Libra, Cryptocurrency Rival to Bitcoin</a></h3><div class="right wsj-card-feature wsj-card-media Image" style="max-width:110px;" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.3"><div class="wsj-image wsj-card-media-item" itemscope="" itemtype="http://schema.org/ImageObject" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.3.0"><meta itemprop="contentUrl" content="https://images.wsj.net/im-82813?width=110&amp;height=73" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.3.0.0"><meta itemprop="caption description" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.3.0.1"><div class="ResponsiveMedia dj-sg bottomInView topInView" style="padding-bottom:66.3636%;" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.3.0.2"><a class="wsj-image-link responsive-media-child" href="https://www.wsj.com/articles/facebook-unveils-crypto-wallet-based-on-currency-libra-11560850141" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.3.0.2.0"><img class="wsj-img-content" width="110" height="73" src="https://images.wsj.net/im-82813?width=110&amp;height=73" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.3.0.2.0.0"></a></div></div></div><div class="wsj-card-body clearfix" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.4"><p class="wsj-summary dj-sg wsj-card-feature" itemprop="description" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.4.5"><span data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.4.5.0">Facebook formally announced plans to launch a cryptocurrency called Libra, promising a secure blockchain-based payment system backed by hard assets and designed for mainstream users.</span><span class="spacer" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.4.5.1"> </span><span class="stats" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.4.5.2"><a href="https://www.wsj.com/articles/facebook-unveils-crypto-wallet-based-on-currency-libra-11560850141#comments_sector" class="wsj-comment-count" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.4.5.2.0">2</a><span class="wsj-timestamp dj-sg" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.4.5.2.1">24 minutes ago</span></span></p><ul class="wsj-bullets dj-sg wsj-card-feature" itemprop="articleSection" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.4.6"><li class="wsj-bullet-item icon none" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.4.6.$0"><span data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.4.6.$0.0"> </span><a href="https://www.wsj.com/articles/bitcoin-fans-spy-opportunity-in-facebook-libra-launch-11560859046?tesla=y&amp;mod=article_inline" target="" data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.4.6.$0.$1"><span data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.4.6.$0.$1.0">Bitcoin Fans Spy Opportunity in Libra</span></a><span data-reactid=".1xomz3qzjdq.1.1.7.1.1.1.3.0.0.0.0.1:$1.4.6.$0.2"> </span></li></ul></div></div>"""

    val parsed = ScraperParser.parseNews(".wsj-headline-link", Right(html))
    parsed shouldEqual (Right(
      List(NewsItem(
        "Facebook Unveils Libra, Cryptocurrency Rival to Bitcoin",
        "https://www.wsj.com/articles/facebook-unveils-crypto-wallet-based-on-currency-libra-11560850141"
      ))))
  }
}
